generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  String               @id @default(cuid())
  email               String               @unique
  passwordHash        String
  name                String
  role                Role                 @default(CLIENT)
  isActive            Boolean              @default(true)
  deletedAt           DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  accountant          Accountant?
  activityLogs        ActivityLog[]
  client              Client?
  uploadedDocuments   Document[]
  passwordResetTokens PasswordResetToken[]
  refreshTokens       RefreshToken[]
  feedbacks           Feedback[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

model Accountant {
  id                   String             @id @default(cuid())
  userId               String             @unique
  companyName          String
  cnpj                 String             @unique
  crc                  String
  phone                String?
  stripeCustomerId     String?            @unique
  stripeSubscriptionId String?            @unique
  subscriptionStatus   SubscriptionStatus @default(TRIALING)
  subscriptionPlan     String?
  trialEndsAt          DateTime?
  trialExtended        Boolean            @default(false)
  onboardingCompleted  Boolean            @default(false)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  clients              Client[]
  invitations          Invitation[]
  notifications        Notification[]
  payments             Payment[]
  subscription         Subscription?

  @@index([cnpj])
  @@map("accountants")
}

model Client {
  id                      String            @id @default(cuid())
  userId                  String            @unique
  accountantId            String?           // Optional for standalone individual clients
  companyName             String?
  cpfCnpj                 String            @unique
  phone                   String?
  address                 String?
  city                    String?
  state                   String?
  zipCode                 String?

  // Module enablement flags
  expenseModuleEnabled    Boolean           @default(false)  // Accounting modules (for clients with accountant)
  financialModuleEnabled  Boolean           @default(false)  // Personal finance module (for individual clients)

  // Stripe integration
  stripeCustomerId        String?           @unique

  deletedAt               DateTime?
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
  activityLogs         ActivityLog[]
  accountant           Accountant?       @relation(fields: [accountantId], references: [id], onDelete: Cascade)
  user                 User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  documentFolders      DocumentFolder[]
  requests             DocumentRequest[]
  documents            Document[]
  expenses             Expense[]
  notifications        Notification[]
  payments             Payment[]
  subscription         Subscription?     // Individual clients can have their own subscription

  // Financial Module Relations
  financialTransactions FinancialTransaction[]
  recurringPayments     RecurringPayment[]
  installments          Installment[]
  investments           Investment[]
  financialGoals        FinancialGoal[]
  aiInsights            AIInsight[]
  incomeDistribution    IncomeDistributionConfig?

  @@index([accountantId])
  @@index([cpfCnpj])
  @@map("clients")
}

model DocumentFolder {
  id          String     @id @default(cuid())
  clientId    String
  name        String
  type        FolderType
  icon        String?
  color       String?
  description String?
  sortOrder   Int        @default(0)
  isDefault   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  client      Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  documents   Document[]

  @@index([clientId])
  @@index([type])
  @@map("document_folders")
}

model Document {
  id                 String            @id @default(cuid())
  clientId           String
  requestId          String?
  type               DocumentType
  title              String
  description        String?
  filePath           String
  fileName           String
  mimeType           String
  fileSize           Int
  createdById        String
  deletedAt          DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  folderId           String?
  client             Client            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  createdBy          User              @relation(fields: [createdById], references: [id], onDelete: Cascade)
  folder             DocumentFolder?   @relation(fields: [folderId], references: [id])
  request            DocumentRequest?  @relation(fields: [requestId], references: [id])
  paymentAttachments PaymentDocument[]

  @@index([clientId])
  @@index([folderId])
  @@index([requestId])
  @@index([type])
  @@index([createdAt])
  @@index([createdById])
  @@map("documents")
}

model Payment {
  id                  String              @id @default(cuid())
  clientId            String?
  accountantId        String
  paymentType         PaymentType         @default(CLIENT)
  title               String
  amount              Decimal             @db.Decimal(10, 2)
  paymentDate         DateTime?
  dueDate             DateTime
  paymentMethod       PaymentMethod?
  reference           String?
  notes               String?
  status              PaymentStatus       @default(PENDING)
  receiptPath         String?
  fileName            String?
  mimeType            String?
  fileSize            Int?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  isRecurring         Boolean             @default(false)
  parentPaymentId     String?
  recurringDayOfMonth Int?
  recurringEndDate    DateTime?
  recurringFrequency  RecurringFrequency?
  invoiceAttachedAt   DateTime?
  invoiceAttachedBy   String?
  requiresInvoice     Boolean             @default(false)
  attachedDocuments   PaymentDocument[]
  accountant          Accountant          @relation(fields: [accountantId], references: [id], onDelete: Cascade)
  client              Client?             @relation(fields: [clientId], references: [id])
  parentPayment       Payment?            @relation("RecurringPayments", fields: [parentPaymentId], references: [id])
  childPayments       Payment[]           @relation("RecurringPayments")

  @@index([clientId])
  @@index([accountantId])
  @@index([paymentType])
  @@index([status])
  @@index([dueDate])
  @@index([paymentDate])
  @@index([isRecurring])
  @@index([parentPaymentId])
  @@map("payments")
}

model PaymentDocument {
  id         String   @id @default(cuid())
  paymentId  String
  documentId String
  attachedAt DateTime @default(now())
  attachedBy String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  payment    Payment  @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@unique([paymentId, documentId])
  @@index([paymentId])
  @@index([documentId])
  @@map("payment_documents")
}

model Expense {
  id          String          @id @default(cuid())
  clientId    String
  category    ExpenseCategory
  description String
  amount      Decimal         @db.Decimal(10, 2)
  date        DateTime
  receiptPath String?
  fileName    String?
  mimeType    String?
  fileSize    Int?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  client      Client          @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([date])
  @@index([category])
  @@map("expenses")
}

model DocumentRequest {
  id          String        @id @default(cuid())
  clientId    String
  type        String
  description String
  status      RequestStatus @default(PENDING)
  dueDate     DateTime?
  fulfilledAt DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  client      Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  documents   Document[]

  @@index([clientId])
  @@index([status])
  @@map("document_requests")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("password_reset_tokens")
}

model ActivityLog {
  id          String   @id @default(cuid())
  clientId    String
  userId      String
  action      String
  description String
  metadata    Json?
  createdAt   DateTime @default(now())
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([userId])
  @@index([createdAt])
  @@map("activity_logs")
}

model Notification {
  id           String           @id @default(cuid())
  clientId     String?
  type         NotificationType
  title        String
  message      String
  isRead       Boolean          @default(false)
  metadata     Json?
  createdAt    DateTime         @default(now())
  readAt       DateTime?
  accountantId String?
  accountant   Accountant?      @relation(fields: [accountantId], references: [id], onDelete: Cascade)
  client       Client?          @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([accountantId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model Plan {
  id                   String         @id @default(cuid())
  name                 String
  slug                 String         @unique
  description          String?
  tenantType           TenantType
  priceMonthly         Decimal        @db.Decimal(10, 2)
  priceYearly          Decimal        @db.Decimal(10, 2)
  stripePriceIdMonthly String?        @unique
  stripePriceIdYearly  String?        @unique
  stripeProductId      String?        @unique
  limitsJson           Json
  featuresJson         Json
  isActive             Boolean        @default(true)
  sortOrder            Int            @default(0)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  subscriptions        Subscription[]

  @@index([slug])
  @@index([tenantType])
  @@index([isActive])
  @@map("plans")
}

model Subscription {
  id                   String             @id @default(cuid())
  accountantId         String?            @unique // For accountant firms
  clientId             String?            @unique // For individual clients
  planId               String
  status               SubscriptionStatus @default(TRIALING)
  interval             BillingInterval    @default(MONTHLY)
  stripeSubscriptionId String?            @unique
  stripeCustomerId     String?
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  trialEnd             DateTime?
  canceledAt           DateTime?
  cancelAtPeriodEnd    Boolean            @default(false)
  metadata             Json?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  invoices             Invoice[]
  accountant           Accountant?        @relation(fields: [accountantId], references: [id], onDelete: Cascade)
  client               Client?            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  plan                 Plan               @relation(fields: [planId], references: [id])
  usageRecords         UsageRecord[]

  @@index([accountantId])
  @@index([clientId])
  @@index([planId])
  @@index([status])
  @@index([stripeSubscriptionId])
  @@map("subscriptions")
}

model Invoice {
  id                    String        @id @default(cuid())
  subscriptionId        String
  stripeInvoiceId       String?       @unique
  stripePaymentIntentId String?       @unique
  invoiceNumber         String        @unique
  status                InvoiceStatus @default(OPEN)
  amount                Decimal       @db.Decimal(10, 2)
  currency              String        @default("BRL")
  periodStart           DateTime
  periodEnd             DateTime
  dueDate               DateTime?
  paidAt                DateTime?
  voidedAt              DateTime?
  invoicePdfUrl         String?
  hostedInvoiceUrl      String?
  metadata              Json?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  subscription          Subscription  @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([status])
  @@index([stripeInvoiceId])
  @@index([createdAt])
  @@map("invoices")
}

model UsageRecord {
  id             String       @id @default(cuid())
  subscriptionId String
  paymentsCount  Int          @default(0)
  expensesCount  Int          @default(0)
  documentsCount Int          @default(0)
  storageUsedMB  Int          @default(0)
  periodStart    DateTime
  periodEnd      DateTime
  metadata       Json?
  createdAt      DateTime     @default(now())
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([periodStart])
  @@map("usage_records")
}

model Invitation {
  id           String     @id @default(cuid())
  accountantId String
  email        String
  name         String?
  cpfCnpj      String?
  token        String     @unique
  expiresAt    DateTime
  acceptedAt   DateTime?
  createdAt    DateTime   @default(now())
  accountant   Accountant @relation(fields: [accountantId], references: [id], onDelete: Cascade)

  @@index([accountantId])
  @@index([token])
  @@index([email])
  @@map("invitations")
}

model Feedback {
  id        String         @id @default(cuid())
  userId    String
  tipo      FeedbackType
  titulo    String
  descricao String
  avaliacao Int?
  status    FeedbackStatus @default(PENDENTE)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([tipo])
  @@index([createdAt])
  @@map("feedbacks")
}

enum Role {
  ADMIN
  ACCOUNTANT
  CLIENT
}

enum SubscriptionStatus {
  TRIALING
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
  INCOMPLETE
}

enum DocumentType {
  NFE
  NFSE
  CTE
  RECEIPT
  CONTRACT
  BANK_STATEMENT
  STATEMENT
  OTHER
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  CANCELED
  AWAITING_INVOICE
  READY_TO_PAY
  AWAITING_VALIDATION
}

enum RequestStatus {
  PENDING
  FULFILLED
  EXPIRED
}

enum PaymentMethod {
  CASH
  PIX
  BANK_TRANSFER
  CREDIT_CARD
  DEBIT_CARD
  BOLETO
}

enum PaymentType {
  CLIENT
  OFFICE
}

enum RecurringFrequency {
  MONTHLY
  QUARTERLY
  SEMIANNUAL
  YEARLY
}

enum NotificationType {
  DOCUMENT_AVAILABLE
  DOCUMENT_REQUESTED
  PAYMENT_REGISTERED
  PAYMENT_OVERDUE
  INVITATION_RECEIVED
}

enum ExpenseCategory {
  FOOD
  TRANSPORT
  HEALTH
  EDUCATION
  OTHER
}

enum FolderType {
  NOTAS_FISCAIS
  CONTRATOS
  DECLARACOES
  COMPROVANTES
  BALANCETES
  OUTROS
}

enum BillingInterval {
  MONTHLY
  YEARLY
}

enum TenantType {
  INDIVIDUAL
  ACCOUNTANT_FIRM
}

enum InvoiceStatus {
  DRAFT
  OPEN
  PAID
  VOID
  UNCOLLECTIBLE
}

enum FeedbackType {
  DUVIDA
  PROBLEMA
  MELHORIA
  AVALIACAO
}

enum FeedbackStatus {
  PENDENTE
  EM_ANALISE
  RESOLVIDO
}

// ============================================
// FINANCIAL MODULE ENUMS
// ============================================

enum TransactionType {
  INCOME
  EXPENSE
}

enum TransactionCategory {
  // Income categories
  SALARY
  FREELANCE
  INVESTMENT_RETURN
  GIFT
  OTHER_INCOME

  // Expense categories
  FOOD
  TRANSPORT
  HEALTH
  EDUCATION
  HOUSING
  UTILITIES
  ENTERTAINMENT
  SHOPPING
  SUBSCRIPTION
  INSURANCE
  INVESTMENT
  FURNITURE
  EQUIPMENT
  OTHER_EXPENSE
}

enum TransactionSource {
  MANUAL
  RECURRING
  INSTALLMENT
  INVESTMENT
}

enum InstallmentStatus {
  ACTIVE
  COMPLETED
  CANCELED
}

enum InstallmentPaymentStatus {
  PENDING
  PAID
  OVERDUE
  SKIPPED
}

enum InvestmentType {
  STOCK
  FUND
  FIXED_INCOME
  CRYPTO
  REAL_ESTATE
  SAVINGS_BOX
  OTHER
}

enum InvestmentTransactionType {
  DEPOSIT
  WITHDRAWAL
  DIVIDEND
  INTEREST
  PROFIT
  LOSS
}

enum GoalPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum GoalViability {
  VIABLE
  CHALLENGING
  IMPOSSIBLE
}

enum GoalStatus {
  ACTIVE
  COMPLETED
  CANCELED
  PAUSED
}

enum AIInsightType {
  SPENDING_ALERT
  SAVING_OPPORTUNITY
  GOAL_SUGGESTION
  RECURRING_OPTIMIZATION
  CATEGORY_ANALYSIS
  INVESTMENT_SUGGESTION
  BUDGET_WARNING
}

enum InsightPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// ============================================
// FINANCIAL MODULE MODELS
// ============================================

model FinancialTransaction {
  id                    String                    @id @default(cuid())
  clientId              String
  type                  TransactionType
  category              TransactionCategory
  description           String
  amount                Decimal                   @db.Decimal(10, 2)
  date                  DateTime
  paymentMethod         PaymentMethod?
  isFixed               Boolean                   @default(false)
  notes                 String?
  receiptPath           String?
  fileName              String?
  mimeType              String?
  fileSize              Int?

  // Source tracking
  sourceType            TransactionSource?
  sourceId              String?

  // Metadata
  metadata              Json?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  deletedAt             DateTime?

  // Relations
  client                Client                    @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([type])
  @@index([category])
  @@index([date])
  @@index([sourceType, sourceId])
  @@map("financial_transactions")
}

model RecurringPayment {
  id                    String                    @id @default(cuid())
  clientId              String
  title                 String
  description           String?
  amount                Decimal                   @db.Decimal(10, 2)
  category              TransactionCategory
  frequency             RecurringFrequency
  dayOfMonth            Int
  startDate             DateTime?
  endDate               DateTime?
  isActive              Boolean                   @default(true)
  lastProcessedDate     DateTime?
  nextDueDate           DateTime?

  // Metadata
  metadata              Json?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  client                Client                    @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([isActive])
  @@map("recurring_payments")
}

model Installment {
  id                    String                    @id @default(cuid())
  clientId              String
  title                 String
  description           String?
  totalAmount           Decimal                   @db.Decimal(10, 2)
  installmentCount      Int
  installmentAmount     Decimal                   @db.Decimal(10, 2)
  category              TransactionCategory
  firstDueDate          DateTime

  // Status tracking
  paidCount             Int                       @default(0)
  status                InstallmentStatus         @default(ACTIVE)

  // Metadata
  metadata              Json?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  client                Client                    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  payments              InstallmentPayment[]

  @@index([clientId])
  @@index([status])
  @@map("installments")
}

model InstallmentPayment {
  id                    String                    @id @default(cuid())
  installmentId         String
  installmentNumber     Int
  amount                Decimal                   @db.Decimal(10, 2)
  dueDate               DateTime
  paidDate              DateTime?
  status                InstallmentPaymentStatus  @default(PENDING)

  // Transaction reference
  transactionId         String?

  // Receipt
  receiptPath           String?
  fileName              String?
  mimeType              String?
  fileSize              Int?

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  installment           Installment               @relation(fields: [installmentId], references: [id], onDelete: Cascade)

  @@index([installmentId])
  @@index([status])
  @@index([dueDate])
  @@map("installment_payments")
}

model Investment {
  id                    String                    @id @default(cuid())
  clientId              String
  type                  InvestmentType
  name                  String
  description           String?
  ticker                String?

  // Amounts
  totalInvested         Decimal                   @db.Decimal(10, 2) @default(0)
  currentValue          Decimal                   @db.Decimal(10, 2) @default(0)
  currentQuantity       Decimal                   @db.Decimal(10, 4) @default(0)
  averagePrice          Decimal                   @db.Decimal(10, 2) @default(0)

  // Metadata
  metadata              Json?
  deletedAt             DateTime?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  client                Client                    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  transactions          InvestmentTransaction[]

  @@index([clientId])
  @@index([type])
  @@map("investments")
}

model InvestmentTransaction {
  id                    String                    @id @default(cuid())
  investmentId          String
  type                  InvestmentTransactionType
  amount                Decimal                   @db.Decimal(10, 2)
  date                  DateTime
  description           String?

  // For returns/dividends - creates income transaction
  createdTransactionId  String?

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  investment            Investment                @relation(fields: [investmentId], references: [id], onDelete: Cascade)

  @@index([investmentId])
  @@index([type])
  @@index([date])
  @@map("investment_transactions")
}

model FinancialGoal {
  id                    String                    @id @default(cuid())
  clientId              String
  title                 String
  description           String?
  targetAmount          Decimal                   @db.Decimal(10, 2)
  currentAmount         Decimal                   @db.Decimal(10, 2) @default(0)
  targetDate            DateTime
  priority              GoalPriority              @default(MEDIUM)
  category              GoalCategory?

  // AI Analysis
  monthlyRequired       Decimal?                  @db.Decimal(10, 2)
  monthlyContribution   Decimal?                  @db.Decimal(10, 2)
  viability             GoalViability?
  aiSuggestions         String?
  lastAIAnalysis        DateTime?

  status                GoalStatus                @default(ACTIVE)
  completedAt           DateTime?
  notes                 String?

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  client                Client                    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  items                 GoalItem[]
  contributions         GoalContribution[]

  @@index([clientId])
  @@index([status])
  @@index([priority])
  @@map("financial_goals")
}

model GoalItem {
  id                    String                    @id @default(cuid())
  goalId                String
  title                 String
  description           String?
  amount                Decimal                   @default(0) @db.Decimal(10, 2)
  isPurchased           Boolean                   @default(false)
  purchasedAt           DateTime?
  order                 Int                       @default(0)
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  goal                  FinancialGoal             @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@index([isPurchased])
  @@map("goal_items")
}

model GoalContribution {
  id                    String                    @id @default(cuid())
  goalId                String
  amount                Decimal                   @db.Decimal(10, 2)
  date                  DateTime                  @default(now())
  notes                 String?
  createdAt             DateTime                  @default(now())

  // Relations
  goal                  FinancialGoal             @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@index([date])
  @@map("goal_contributions")
}

enum GoalCategory {
  EMERGENCY_FUND
  RETIREMENT
  VACATION
  HOUSE
  CAR
  EDUCATION
  WEDDING
  BUSINESS
  DEBT_PAYMENT
  OTHER
}

model AIInsight {
  id                    String                    @id @default(cuid())
  clientId              String
  type                  AIInsightType
  title                 String
  content               String
  priority              InsightPriority           @default(MEDIUM)
  category              String?

  // Actions
  isRead                Boolean                   @default(false)
  isDismissed           Boolean                   @default(false)
  readAt                DateTime?

  // Context
  metadata              Json?
  validUntil            DateTime?

  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt

  // Relations
  client                Client                    @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([isRead])
  @@index([type])
  @@index([priority])
  @@map("ai_insights")
}

// ==========================================
// INCOME DISTRIBUTION MODELS
// ==========================================

model IncomeDistributionConfig {
  id                    String                      @id @default(cuid())
  clientId              String                      @unique
  
  // Auto-calculated monthly expenses
  isAutoCalculateExpenses Boolean                   @default(true)
  
  // Settings
  isActive              Boolean                     @default(true)
  
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime                    @updatedAt
  
  // Relations
  client                Client                      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  categories            IncomeDistributionCategory[]
  
  @@index([clientId])
  @@map("income_distribution_configs")
}

model IncomeDistributionCategory {
  id                    String                      @id @default(cuid())
  configId              String
  
  // Category details
  name                  String                      // e.g., "PrevidÃªncia Privada", "Fundo Emergencial", "Lazer"
  percentage            Float                       // Percentage to allocate (0-100)
  color                 String?                     // Color for UI
  icon                  String?                     // Icon name for UI
  
  // Priority (1 = highest priority)
  priority              Int                         @default(999)
  
  // Status
  isActive              Boolean                     @default(true)
  
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime                    @updatedAt
  
  // Relations
  config                IncomeDistributionConfig    @relation(fields: [configId], references: [id], onDelete: Cascade)
  
  @@index([configId])
  @@index([priority])
  @@map("income_distribution_categories")
}
